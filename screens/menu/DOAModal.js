import React, { useRef, useState } from 'react';
import { View, ScrollView, Alert, SafeAreaView, Modal, Text, TouchableOpacity, StyleSheet } from 'react-native';
import Ionicons from 'react-native-vector-icons/Ionicons';
import { useSelector } from 'react-redux';
import SectionTitle from '../components/SectionTitle';
import Subtitle from '../components/Subtitle';
import Divider from '../components/Divider';
import { useTheme } from '../../ThemeContext';


const DOAModal = ({ navigation, DOAModalVisible, setDOAModalVisible }) => {
  const userInfo = useSelector((state) => state.bank.userInfo);
  const currentDate = new Date();
  const day = currentDate.getDate();
  const month = currentDate.toLocaleString('default', { month: 'long' });
  const year = currentDate.getFullYear();
  const [isSaved, setIsSaved] = useState(false);
  const scrollViewRef = useRef(null);

  const { isDarkMode, colors } = useTheme();
  const styles = createStyles(isDarkMode);  


  const saveAsImage = async () => {
    // Capture the content of the ScrollView as an image
    const uri = await captureRef(scrollViewRef, {
      format: 'jpg', // You can choose other formats like 'png' or 'webm'
      quality: 1, // Image quality (0 to 1)
    });
  
    // Save the captured image to the device's gallery
    CameraRoll.save(uri, { type: 'photo' })
      .then(() => {
        setIsSaved(true);
      })
      .catch((error) => {
        console.error('Error saving image: ', error);
      });
  };
  

  return (
    <Modal
      animationType="slide"
      transparent={true}
      visible={DOAModalVisible}
      onRequestClose={() => setDOAModalVisible(false)}
    >
      <View style={styles.modalContainer}>
        <ScrollView
          ref={scrollViewRef}
          style={styles.modalContent}
          contentContainerStyle={styles.contentContainer}
        >
          <View style={styles.modalContent}>
            <View style={styles.modalHeaderContainer}>
              <Text style={styles.modalHeader}>Deed of Agreement</Text>
              <Ionicons
                name="close-outline"
                size={24}
                color="grey"
                marginTop={22}
                paddingRight={25}
                onPress={() => setDOAModalVisible(false)}
              />
            </View>
            <Divider />
            <Subtitle>
              Agreement between {userInfo.firstName} {userInfo.lastName} and MyFund
            </Subtitle>

<SafeAreaView>
      <ScrollView style={styles.scrollView} >

        <SectionTitle>INTRODUCTION</SectionTitle>
        <Text style={styles.bodyText}>
          This Deed of Agreement ("Agreement") is entered into on this {day} day of {month}, {year} (the "Effective Date") by and
          between:
        </Text>

        <SectionTitle>PARTIES</SectionTitle>
        <Text style={styles.bodyText}>
          WHEREAS, Party A ({userInfo.firstName} {userInfo.lastName}) is a registered user of the MyFund platform and intends to purchase
          properties through the platform.
        </Text>
        <Text style={styles.bodyText}>
          WHEREAS, Party B (MyFund) operates the MyFund platform and provides property investment opportunities to registered users, and operating at 13, Gbajabiamila Street, Ayobo, Lagos. And also via the webapp at www.myfundmobile.com. And can be contacted via the office line: +2349032719396.
        </Text>

        <SectionTitle>PROPERTY COST AND RENTAL INCOME</SectionTitle>
        <Text style={styles.bodyText}>
          1.1 Party A will pay the amount stated as cost on the property and agrees to a 5% charge for processing fee.
        </Text>
        <Text style={styles.bodyText}>
          1.2 Party A acknowledges that they will earn 70% of the rental income generated by the property purchased through the MyFund
          platform, and Party B shall deduct 30% as for managment fees. The rental income will be earned annually as long as the property is
          operational and earning rent.
        </Text>
        <Text style={styles.bodyText}>
          1.3 Party A understands that the rental income may increase over time, as it is calculated as a percentage of the property's
          rental earnings.
        </Text>

        <SectionTitle>WAITING PERIOD</SectionTitle>
        <Text style={styles.bodyText}>
          2.1 If the selected property has a waiting period attached to it, and party A wants to pay ahead as an early mover, Party A agrees to a waiting period of 9 months for the property purchased. Party B shall not list properties that are not
          expected to be available within this period.
        </Text>

        <SectionTitle>SALE OF PROPERTY</SectionTitle>
        <Text style={styles.bodyText}>
          3.1 If Party A wishes to sell a property, the property will be listed for sale on the MyFund platform, and the proceeds from the
          sale will be credited to Party A's wallet upon completion. A processing fee, typically between 5-10% of the sale price, will be
          deducted from the sale proceeds.
        </Text>
        <Text style={styles.bodyText}>
          3.2 Party A acknowledges that the sale price of the property may not be the same as the purchase price, as property values can
          fluctuate based on factors such as inflation and current property valuations. Property values may decrease, and Party A should be
          aware that properties may not appreciate in value like land.
        </Text>

        <SectionTitle>TRANSACTION COSTS</SectionTitle>
        <Text style={styles.bodyText}>
          4.1 Party A is responsible for all transaction costs associated with the purchase and sale of the property, including but not
          limited to legal fees, property transfer taxes, and any other expenses. Party A also acknowledges that they will forfeit the yearly
          rental income of the property upon the completion of the property's sale.
        </Text>

        <SectionTitle>APP-BASED TRANSACTIONS</SectionTitle>
        <Text style={styles.bodyText}>
          5.1 All transactions, communications, and activities related to the purchase, sale, and management of properties, including the
          calculation and distribution of rental income, shall be conducted through the MyFund mobile application. The Parties agree that using
          the app is essential for record-keeping and transparency.
        </Text>

        <SectionTitle>GOVERNING LAW</SectionTitle>
        <Text style={styles.bodyText}>
          6.1 This Agreement shall be governed by and construed in accordance with the laws of the Federal Republic of Nigeria.
        </Text>

        <SectionTitle>ENTIRE AGREEMENT</SectionTitle>
        <Text style={styles.bodyText}>
          7.1 This Agreement constitutes the entire agreement between the Parties and supersedes all prior and contemporaneous understandings,
          agreements, representations, and warranties.
        </Text>

        </ScrollView>

        <TouchableOpacity style={styles.primaryButton} onPress={() => setDOAModalVisible(false)}>
          <Text style={styles.primaryButtonText}>Confirm and Proceed</Text>
          <Ionicons name="arrow-forward-outline" size={30} color="#fff" />

        </TouchableOpacity>
</SafeAreaView>
    </View>
    </ScrollView>
  </View>


</Modal>
  );
};

const createStyles = (isDarkMode) => {
  return StyleSheet.create({
  modalContainer: {
    flex: 1,
    justifyContent: 'flex-end',
    alignItems: 'center',
    backgroundColor: 'rgba(0, 0, 0, 0.6)',
  },

  modalContent: {
    backgroundColor: isDarkMode ? '#271561' : '#F5F1FF',
    borderTopRightRadius: 25,
    borderTopLeftRadius: 25,
    borderBottomLeftRadius: 0,
    borderBottomRightRadius: 0,
    flex: 1, // Allow the content to take up the available space
  },
  contentContainer: {
    paddingHorizontal: 20,
    paddingTop: 20,
    paddingBottom: 60,
  },

  scrollView: {
    paddingHorizontal: -5,
  },
  
  modalHeaderContainer: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    paddingLeft: 30,
  },
  modalHeader: {
    marginTop: 20,
    fontSize: 25,
    fontFamily: 'proxima',
    color: isDarkMode ? '#fff' : '#4C28BC',
    flex: 1,
  },
  modalSubText: {
    fontSize: 14,
    fontFamily: 'karla',
    color: 'black',
    textAlign: 'left',
    marginHorizontal: 30,
    marginTop: 5,
    color: isDarkMode ? '#fff' : 'black',
  },
   
  container: {
    flex: 1,
    backgroundColor: '#F5F1FF',
  },
  header: {
    marginTop: 50,
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    paddingHorizontal: 15,
    backgroundColor: isDarkMode ? 'black' : '#fff',
    height: 43,
  },
  headerContainer: {
    flex: 1,
    flexDirection: 'row',
    justifyContent: 'flex-end',
  },
  

  contentContainer: {
    paddingHorizontal: 30,
    paddingTop: 20,
    paddingBottom: 60,
  },
  bodyText: {
    fontFamily: 'karla',
    fontSize: 15,
    marginBottom: 20,
    paddingHorizontal: 20,
    color: isDarkMode ? '#fff' : 'black',
  },

  scrollToBottomButton: {
    position: 'absolute',
    bottom: 20,
    right: 20,
    backgroundColor: 'white',
    borderRadius: 50,
    padding: 10,
    elevation: 5, // Add elevation for a shadow effect
  },
  scrollToBottomButtonText: {
    color: '#fff',
    fontSize: 18,
    fontFamily: 'ProductSans',
  },

  primaryButton: {
    flexDirection: 'row',
    backgroundColor: '#4C28BC',
    width: '90%',
    height: 50,
    alignItems: 'center',
    justifyContent: 'center',
    borderRadius: 10,
    alignSelf: 'center',
    marginVertical: 10,
  },
  primaryButtonText: {
    color: '#fff',
    fontSize: 18,
    fontFamily: 'ProductSans',
    marginRight: 5,
  },
  saveButton: {
    backgroundColor: '#4C28BC',
    width: '85%',
    height: 50,
    alignItems: 'center',
    justifyContent: 'center',
    borderRadius: 10,
    alignSelf: 'center',
    marginVertical: 10,
  },
  
  saveButtonText: {
    color: '#fff',
    fontSize: 18,
    fontFamily: 'ProductSans',
  },
  
});
}

export default DOAModal;
